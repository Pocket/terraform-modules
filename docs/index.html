<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@pocket/terraform-modules</title><meta name="description" content="Documentation for @pocket/terraform-modules"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@pocket/terraform-modules</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>@pocket/terraform-modules </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#terraform-modules" id="terraform-modules" style="color: inherit; text-decoration: none;">
  <h1>terraform-modules</h1>
</a>
<p>This is a collection of terraform typescript cdk modules
that @Pocket uses in various services.</p>

<a href="#why" id="why" style="color: inherit; text-decoration: none;">
  <h2>Why?</h2>
</a>
<p>Our goals for this project are as follows:</p>
<ul>
<li>To have as little infrastructure code as possible in repos.</li>
<li>To have as little <em>duplicated</em> infrastructure code as possible in repos.</li>
<li>To provide reasonable defaults for our most common AWS services.</li>
<li>To provide an as-simple-as-possible-while-still-configurable API to our most common AWS services by abstraction.</li>
</ul>

<a href="#repository-structure" id="repository-structure" style="color: inherit; text-decoration: none;">
  <h2>Repository Structure</h2>
</a>
<p>The bulk of the code for this repository is broken up into two folders:</p>
<ul>
<li><code>/src/base</code>: Contains abstractions of AWS services, e.g. an ECS or Redis Cluster, or an SQS Queue</li>
<li><code>/src/pocket</code>: Contains higher level abstractions that are specific to Pocket&#39;s infrastructure, e.g. an ALB-backed application or our PagerDuty config</li>
</ul>
<p>See the <code>README</code> file in each of these respective directories to learn more. (Coming soon.)</p>

<a href="#testing" id="testing" style="color: inherit; text-decoration: none;">
  <h2>Testing</h2>
</a>

<a href="#snapshot-testing" id="snapshot-testing" style="color: inherit; text-decoration: none;">
  <h3>Snapshot Testing</h3>
</a>
<p>Snapshot testing ensures that our components produce predictable output when synthesized.</p>
<p>When a snapshot test is first run, it generates a snapshot (in a <code>__snapshots__</code> directory) that is used to compare future synthesizing against a known, expected output. If a component changes, it&#39;s likely that the expected snapshot should change. If you are making a PR that changes a component, you should also update the related snapshot file. This can be done by running the test command with additional flags instructing Jest to re-build the snapshot based on the new state of the component:</p>
<p><code>npm test -- -u</code></p>
<p>The above will update any necessary snapshot files to be used on future test runs.</p>
<p>As you can infer from the above, snapshots do not test the actual infrastructure result of running the synthesized terraform, meaning components should be tested manually (see below) to ensure they are performing the expected tasks prior to writing snapshot tests.</p>

<a href="#testing-in-aws" id="testing-in-aws" style="color: inherit; text-decoration: none;">
  <h3>Testing in AWS</h3>
</a>
<p>While snapshot testing is great for things like regressions, it doesn&#39;t actually tell us if the code we&#39;ve provided (e.g. the configuration of a particular AWS service) can be built in AWS.</p>
<p>You can use the existing <code>example.ts</code> file to test the modules in this repo.</p>
<ol>
<li>Install <a href="https://github.com/tfutils/tfenv">tfenv</a></li>
<li>Run <code>tfenv use</code> to ensure you are on the latest terraform version this repo is built for.</li>
<li>Run <code>npm run build:dev</code></li>
<li><code>cd</code> into the generated <code>cdktf.out/stacks/acme-example</code> directory</li>
<li>Run <code>terraform init</code></li>
<li>Run <code>terraform validate</code> to validate the generated JSON (debugging level 1)</li>
</ol>
<p>To test against our infrastructure (debugging level 2):</p>
<ol>
<li>Log into terraform <code>terraform login</code> if not already. You will be prompted to save an API token.</li>
<li>Run <code>$(maws)</code> and select the ðŸ‘‰devðŸ‘ˆ backend SSO role (triple check that you are in DEV)</li>
<li>Run <code>terraform plan</code></li>
<li>Check one more time that you are in the dev account</li>
<li>Check with your teammates that it&#39;s okay to blow up the dev infra, then run <code>terraform apply</code></li>
<li>Clean up your mess by running <code>terraform destroy</code> when you&#39;re all done</li>
</ol>
<p>Note that this isn&#39;t a full end-to-end verification, and will hang on domain certificate steps, but the above should surface most generated terraform issues.</p>

<a href="#testing-in-dependent-repos" id="testing-in-dependent-repos" style="color: inherit; text-decoration: none;">
  <h3>Testing in Dependent Repos</h3>
</a>
<p>Sometimes it is useful to develop the module while consuming it in another repo.</p>
<ol>
<li>Run <code>npm link</code> in the root of this repo</li>
<li>In the consumer repo run <code>npm link @pocket/terraform-modules</code></li>
<li>In this repo run <code>npm run watch</code></li>
<li>Profit in the consumer repo - meaning, test deploying your application to AWS (probably in the dev account)</li>
</ol>
<p>When you are done be sure to:</p>
<ol>
<li><code>npm unlink</code> in this repo</li>
<li><code>npm unlink @pocket/terraform-modules</code> in the consuming repo</li>
</ol>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-enum"><a href="enums/ApplicationDynamoDBTableCapacityMode.html" class="tsd-kind-icon">Application<wbr/>DynamoDBTable<wbr/>Capacity<wbr/>Mode</a></li><li class="tsd-kind-enum"><a href="enums/ApplicationDynamoDBTableCapacityType.html" class="tsd-kind-icon">Application<wbr/>DynamoDBTable<wbr/>Capacity<wbr/>Type</a></li><li class="tsd-kind-enum"><a href="enums/ApplicationElasticacheEngine.html" class="tsd-kind-icon">Application<wbr/>Elasticache<wbr/>Engine</a></li><li class="tsd-kind-enum"><a href="enums/LAMBDA_RUNTIMES.html" class="tsd-kind-icon">LAMBDA_<wbr/>RUNTIMES</a></li><li class="tsd-kind-enum"><a href="enums/PAGERDUTY_SERVICE_URGENCY.html" class="tsd-kind-icon">PAGERDUTY_<wbr/>SERVICE_<wbr/>URGENCY</a></li><li class="tsd-kind-class"><a href="classes/ApplicationAutoscaling.html" class="tsd-kind-icon">Application<wbr/>Autoscaling</a></li><li class="tsd-kind-class"><a href="classes/ApplicationBaseDNS.html" class="tsd-kind-icon">Application<wbr/>BaseDNS</a></li><li class="tsd-kind-class"><a href="classes/ApplicationCertificate.html" class="tsd-kind-icon">Application<wbr/>Certificate</a></li><li class="tsd-kind-class"><a href="classes/ApplicationDynamoDBTable.html" class="tsd-kind-icon">Application<wbr/>DynamoDBTable</a></li><li class="tsd-kind-class"><a href="classes/ApplicationECR.html" class="tsd-kind-icon">ApplicationECR</a></li><li class="tsd-kind-class"><a href="classes/ApplicationECSAlbCodeDeploy.html" class="tsd-kind-icon">ApplicationECSAlb<wbr/>Code<wbr/>Deploy</a></li><li class="tsd-kind-class"><a href="classes/ApplicationECSCluster.html" class="tsd-kind-icon">ApplicationECSCluster</a></li><li class="tsd-kind-class"><a href="classes/ApplicationECSIAM.html" class="tsd-kind-icon">ApplicationECSIAM</a></li><li class="tsd-kind-class"><a href="classes/ApplicationECSService.html" class="tsd-kind-icon">ApplicationECSService</a></li><li class="tsd-kind-class"><a href="classes/ApplicationElasticacheCluster.html" class="tsd-kind-icon">Application<wbr/>Elasticache<wbr/>Cluster</a></li><li class="tsd-kind-class"><a href="classes/ApplicationEventBridgeRule.html" class="tsd-kind-icon">Application<wbr/>Event<wbr/>Bridge<wbr/>Rule</a></li><li class="tsd-kind-class"><a href="classes/ApplicationEventBus.html" class="tsd-kind-icon">Application<wbr/>Event<wbr/>Bus</a></li><li class="tsd-kind-class"><a href="classes/ApplicationLambdaCodeDeploy.html" class="tsd-kind-icon">Application<wbr/>Lambda<wbr/>Code<wbr/>Deploy</a></li><li class="tsd-kind-class"><a href="classes/ApplicationLoadBalancer.html" class="tsd-kind-icon">Application<wbr/>Load<wbr/>Balancer</a></li><li class="tsd-kind-class"><a href="classes/ApplicationMemcache.html" class="tsd-kind-icon">Application<wbr/>Memcache</a></li><li class="tsd-kind-class"><a href="classes/ApplicationRDSCluster.html" class="tsd-kind-icon">ApplicationRDSCluster</a></li><li class="tsd-kind-class"><a href="classes/ApplicationRedis.html" class="tsd-kind-icon">Application<wbr/>Redis</a></li><li class="tsd-kind-class"><a href="classes/ApplicationSQSQueue.html" class="tsd-kind-icon">ApplicationSQSQueue</a></li><li class="tsd-kind-class"><a href="classes/ApplicationSqsSnsTopicSubscription.html" class="tsd-kind-icon">Application<wbr/>Sqs<wbr/>Sns<wbr/>Topic<wbr/>Subscription</a></li><li class="tsd-kind-class"><a href="classes/ApplicationTargetGroup.html" class="tsd-kind-icon">Application<wbr/>Target<wbr/>Group</a></li><li class="tsd-kind-class"><a href="classes/ApplicationVersionedLambda.html" class="tsd-kind-icon">Application<wbr/>Versioned<wbr/>Lambda</a></li><li class="tsd-kind-class"><a href="classes/PocketALBApplication.html" class="tsd-kind-icon">PocketALBApplication</a></li><li class="tsd-kind-class"><a href="classes/PocketApiGateway.html" class="tsd-kind-icon">Pocket<wbr/>Api<wbr/>Gateway</a></li><li class="tsd-kind-class"><a href="classes/PocketECSApplication.html" class="tsd-kind-icon">PocketECSApplication</a></li><li class="tsd-kind-class"><a href="classes/PocketECSCodePipeline.html" class="tsd-kind-icon">PocketECSCode<wbr/>Pipeline</a></li><li class="tsd-kind-class"><a href="classes/PocketEventBridgeRuleWithMultipleTargets.html" class="tsd-kind-icon">Pocket<wbr/>Event<wbr/>Bridge<wbr/>Rule<wbr/>With<wbr/>Multiple<wbr/>Targets</a></li><li class="tsd-kind-class"><a href="classes/PocketEventBridgeWithLambdaTarget.html" class="tsd-kind-icon">Pocket<wbr/>Event<wbr/>Bridge<wbr/>With<wbr/>Lambda<wbr/>Target</a></li><li class="tsd-kind-class"><a href="classes/PocketPagerDuty.html" class="tsd-kind-icon">Pocket<wbr/>Pager<wbr/>Duty</a></li><li class="tsd-kind-class"><a href="classes/PocketSQSWithLambdaTarget.html" class="tsd-kind-icon">PocketSQSWith<wbr/>Lambda<wbr/>Target</a></li><li class="tsd-kind-class"><a href="classes/PocketSyntheticCheck.html" class="tsd-kind-icon">Pocket<wbr/>Synthetic<wbr/>Check</a></li><li class="tsd-kind-class"><a href="classes/PocketVPC.html" class="tsd-kind-icon">PocketVPC</a></li><li class="tsd-kind-class"><a href="classes/PocketVersionedLambda.html" class="tsd-kind-icon">Pocket<wbr/>Versioned<wbr/>Lambda</a></li><li class="tsd-kind-interface"><a href="interfaces/ApiGatewayLambdaRoute.html" class="tsd-kind-icon">Api<wbr/>Gateway<wbr/>Lambda<wbr/>Route</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationAutoscalingProps.html" class="tsd-kind-icon">Application<wbr/>Autoscaling<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationCertificateProps.html" class="tsd-kind-icon">Application<wbr/>Certificate<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationDynamoDBProps.html" class="tsd-kind-icon">Application<wbr/>DynamoDBProps</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationDynamoDBTableAutoScaleProps.html" class="tsd-kind-icon">Application<wbr/>DynamoDBTable<wbr/>Auto<wbr/>Scale<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationECSAlbCodeDeployProps.html" class="tsd-kind-icon">ApplicationECSAlb<wbr/>Code<wbr/>Deploy<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationECSClusterProps.html" class="tsd-kind-icon">ApplicationECSCluster<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationECSContainerDefinitionProps.html" class="tsd-kind-icon">ApplicationECSContainer<wbr/>Definition<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationECSIAMProps.html" class="tsd-kind-icon">ApplicationECSIAMProps</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationECSServiceProps.html" class="tsd-kind-icon">ApplicationECSService<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationElasticacheClusterProps.html" class="tsd-kind-icon">Application<wbr/>Elasticache<wbr/>Cluster<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationEventBridgeRuleProps.html" class="tsd-kind-icon">Application<wbr/>Event<wbr/>Bridge<wbr/>Rule<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationEventBusProps.html" class="tsd-kind-icon">Application<wbr/>Event<wbr/>Bus<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationLoadBalancerProps.html" class="tsd-kind-icon">Application<wbr/>Load<wbr/>Balancer<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationRDSClusterProps.html" class="tsd-kind-icon">ApplicationRDSCluster<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationSQSQueueProps.html" class="tsd-kind-icon">ApplicationSQSQueue<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationSqsSnsTopicSubscriptionProps.html" class="tsd-kind-icon">Application<wbr/>Sqs<wbr/>Sns<wbr/>Topic<wbr/>Subscription<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationTargetGroupProps.html" class="tsd-kind-icon">Application<wbr/>Target<wbr/>Group<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationVersionedLambdaCodeDeployProps.html" class="tsd-kind-icon">Application<wbr/>Versioned<wbr/>Lambda<wbr/>Code<wbr/>Deploy<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ApplicationVersionedLambdaProps.html" class="tsd-kind-icon">Application<wbr/>Versioned<wbr/>Lambda<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/ECRProps.html" class="tsd-kind-icon">ECRProps</a></li><li class="tsd-kind-interface"><a href="interfaces/PocketALBApplicationAlarmProps.html" class="tsd-kind-icon">PocketALBApplication<wbr/>Alarm<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/PocketALBApplicationProps.html" class="tsd-kind-icon">PocketALBApplication<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/PocketApiGatewayProps.html" class="tsd-kind-icon">Pocket<wbr/>Api<wbr/>Gateway<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/PocketECSApplicationProps.html" class="tsd-kind-icon">PocketECSApplication<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/PocketECSCodePipelineProps.html" class="tsd-kind-icon">PocketECSCode<wbr/>Pipeline<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/PocketEventBridgeProps.html" class="tsd-kind-icon">Pocket<wbr/>Event<wbr/>Bridge<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/PocketEventBridgeWithLambdaTargetProps.html" class="tsd-kind-icon">Pocket<wbr/>Event<wbr/>Bridge<wbr/>With<wbr/>Lambda<wbr/>Target<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/PocketPagerDutyProps.html" class="tsd-kind-icon">Pocket<wbr/>Pager<wbr/>Duty<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/PocketSQSProps.html" class="tsd-kind-icon">PocketSQSProps</a></li><li class="tsd-kind-interface"><a href="interfaces/PocketSQSWithLambdaTargetProps.html" class="tsd-kind-icon">PocketSQSWith<wbr/>Lambda<wbr/>Target<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/PocketSyntheticProps.html" class="tsd-kind-icon">Pocket<wbr/>Synthetic<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/PocketVersionedLambdaDefaultAlarmProps.html" class="tsd-kind-icon">Pocket<wbr/>Versioned<wbr/>Lambda<wbr/>Default<wbr/>Alarm<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/PocketVersionedLambdaProps.html" class="tsd-kind-icon">Pocket<wbr/>Versioned<wbr/>Lambda<wbr/>Props</a></li><li class="tsd-kind-interface"><a href="interfaces/RootDNSProps.html" class="tsd-kind-icon">RootDNSProps</a></li><li class="tsd-kind-type-alias"><a href="modules.html#ApplicationDynamoDBTableConfig" class="tsd-kind-icon">Application<wbr/>DynamoDBTable<wbr/>Config</a></li><li class="tsd-kind-type-alias"><a href="modules.html#ApplicationRDSClusterConfig" class="tsd-kind-icon">ApplicationRDSCluster<wbr/>Config</a></li><li class="tsd-kind-type-alias"><a href="modules.html#CreateECSServiceArgs" class="tsd-kind-icon">CreateECSService<wbr/>Args</a></li><li class="tsd-kind-type-alias"><a href="modules.html#PocketEventBridgeTargets" class="tsd-kind-icon">Pocket<wbr/>Event<wbr/>Bridge<wbr/>Targets</a></li><li class="tsd-kind-type-alias"><a href="modules.html#Target" class="tsd-kind-icon">Target</a></li><li class="tsd-kind-function"><a href="modules.html#buildDefinitionJSON" class="tsd-kind-icon">build<wbr/>DefinitionJSON</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>